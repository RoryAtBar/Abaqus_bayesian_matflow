template_components:
  environments:
  - name: abaqus_env
    setup: |
      source /mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/.venv/bin/activate
      module load apps/binapps/abaqus/2022
    executables:
    - label: python_script
      instances:
      - command: python <<script_name>> <<args>>
        num_cores: 1
        parallel_mode: null
    - label: abaqus
      instances:
      - command: abq2022
        num_cores: 1
        parallel_mode: null

  task_schemas:
  - objective: run_abaqus
    inputs:
    - parameter: friction
    - parameter: conductance
    - parameter: power
    - parameter: inp_file
    actions:
    - environments:
      - scope:
          type: any
        environment: abaqus_env
      input_file_generators:
      - input_file: new_inp_file
        from_inputs:
        - friction
        - conductance
        - power
        - inp_file
        script: <<script:/mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/generate_input_file.py>>
      commands:
      - command: <<executable:abaqus>> job=sub_script_check input=<<file:new_inp_file>> interactive
      save_files:
        - odb_file


  command_files:
  - label: new_inp_file
    name:
      name: friction_conductance.inp
  - label: odb_file
    name:
      name: sub_script_check.odb

tasks:
- schema: run_abaqus
  inputs:
    friction: 0.01
    conductance: [0,"/mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/Abaqus_5_min_heatup/800nocondC_heatup22.odb"]
    power: 0
    inp_file: /mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/800C_1s-1_setup.inp
