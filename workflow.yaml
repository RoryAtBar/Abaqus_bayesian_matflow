template_components:
  environments:
  - name: abaqus_env
    setup: |
      source /mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/.venv/bin/activate
      module load apps/binapps/abaqus/2022
    executables:
    - label: python_script
      instances:
      - command: python <<script_name>> <<args>>
        num_cores: 1
        parallel_mode: null
    - label: abaqus
      instances:
      - command: abq2022
        num_cores: 1
        parallel_mode: null

  task_schemas:
  - objective: run_abaqus
    inputs:
    - parameter: friction
    - parameter: conductance_value
    - parameter: conductance_file
    - parameter: power
    - parameter: inp_file
    actions:
    - environments:
      - scope:
          type: any
        environment: abaqus_env
      input_file_generators:
      - input_file: new_inp_file
        from_inputs:
        - friction
        - conductance_value
        - conductance_file
        - power
        - inp_file
        script: <<script:/mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/generate_input_file.py>>
      commands:
      - command: <<executable:abaqus>> job=sub_script_check input=<<file:new_inp_file>> interactive
      - command: <<executable:abaqus>> cae noGUI=/mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/read_Force_PEEQ_NT11_barrelling_forcemac.py
      save_files:
      - odb_file
      - force_sample_set_1
      - force_sample_set_2
      - nt11
      - outer_sample_xcoords
      - peeq_output

  command_files:
  - label: new_inp_file
    name:
      name: friction_conductance.inp
  - label: odb_file
    name:
      name: sub_script_check.odb
  - label: force_sample_set_1
    name:
      name: Force_sample_set1.rpt
  - label: force_sample_set_2
    name:
      name: Force_sample_set2.rpt
  - label: nt11
    name:
      name: NT11.rpt
  - label: outer_sample_xcoords
    name:
      name: outer_sample_xcoords.rpt
  - label: peeq_output
    name:
      name: PEEQ_output.rpt

tasks:
- schema: run_abaqus
  inputs:
    friction: 0.01
    conductance_value: 0
    conductance_file: /mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/Abaqus_5_min_heatup/800nocondC_heatup22.odb
    power: 0
    inp_file: /mnt/iusers01/support/mbexegc2/scratch/Abaqus_bayesian_matflow/800C_1s-1_setup.inp
